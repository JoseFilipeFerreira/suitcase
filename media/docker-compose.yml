services:

  jellyfin:
    image: jellyfin/jellyfin
    container_name: jellyfin
    extends:
      file: hwaccel.transcoding.yml
      service: quicksync
    environment:
      PUID: ${PUID}
      PGID: ${PGID}
      VERSION: docker
    group_add:
      - "989"
    network_mode: host
    volumes:
      - ~/.local/share/music:/music
      - ${MEDIADIR}:/media
      - ${DATADIR}/jellyfin/cache:/cache
      - ${DATADIR}/jellyfin/config:/config
    restart: unless-stopped
    labels:
      com.plato.category: "Media"
      com.plato.subtitle: "Media Streaming"
      com.plato.ui-port: 8096
      com.plato.importance: 5

  jellystat:
    image: cyfershepard/jellystat:latest
    container_name: jellystat
    environment:
      POSTGRES_USER: ${JELLYSTAT_DB_USER}
      POSTGRES_PASSWORD: ${JELLYSTAT_DB_PASSWORD}
      POSTGRES_IP: jellystat-postgres
      POSTGRES_PORT: 5432
      JWT_SECRET: ${JELLYSTAT_JWT_SECRET}
      TZ: ${TZ}
    ports:
      - 3000:3000
    volumes:
      - ${DATADIR}/jellystat/data:/app/backend/backup-data
    depends_on:
      - jellystat-postgres
      - jellyfin
    restart: unless-stopped
    labels:
      com.plato.category: "Infrastructure"
      com.plato.subtitle: "Watch Stats"
      com.plato.importance: 4

  jellystat-postgres:
    image: postgres:15.2
    container_name: jellystat-postgres
    environment:
      POSTGRES_DB: 'jfstat'
      POSTGRES_USER: ${JELLYSTAT_DB_USER}
      POSTGRES_PASSWORD: ${JELLYSTAT_DB_PASSWORD}
    volumes:
      - ${DATADIR}/jellystat-postgres/data:/var/lib/postgresql/data
    restart: unless-stopped

  iron-cake:
    image: josefilipeferreira/iron-cake
    container_name: iron-cake
    ports:
      - 8000:8000
    volumes:
      - ${DATADIR}/iron-cake/thumb:/thumb
      - ${MEDIADIR}/anime:/anime:ro
      - ~/.local/share/music:/music:ro
      - ~/.local/share/wallpapers:/walls:ro
      - ~/repos/receitas/receitas:/receitas:ro
      - ~/share:/share:ro
    restart: unless-stopped
    labels:
      com.plato.category: "Botnet"
      com.plato.subtitle: "Simple Webserver"
      com.plato.importance: 5

  calibre-web:
    image: linuxserver/calibre-web:nightly
    container_name: calibre-web
    environment:
      PUID: ${PUID}
      PGID: ${PGID}
      TZ: ${TZ}
      DOCKER_MODS: linuxserver/mods:universal-calibre
      OAUTHLIB_RELAX_TOKEN_SCOPE: 1
    volumes:
      - ${DATADIR}/calibre-web/config:/config
      - ${DATADIR}/calibre/config/Calibre Library:/books
    ports:
      - 8083:8083
    depends_on:
      - calibre
    restart: unless-stopped
    labels:
      com.plato.category: "Media"
      com.plato.name: "Biblioteca dos Nhos"
      com.plato.subtitle: "Book DB Frontend"
      com.plato.importance: 3

  calibre:
    image: linuxserver/calibre:latest
    container_name: calibre
    environment:
      PUID: ${PUID}
      PGID: ${PGID}
      TZ: ${TZ}
    volumes:
      - ${DATADIR}/calibre/config:/config
      - ${DATADIR}/calibre/import:/import
    ports:
      # - 8082:8080
      # - 8081:8081
      - 8181:8181
    restart: unless-stopped
    labels:
      com.plato.category: "Media"
      com.plato.subtitle: "Book DB"
      com.plato.importance: 2
