version: "3.9"

# merossd     4200
# authelia    9091

services:

  homer:
    image: b4bz/homer
    container_name: homer
    volumes:
      - $DATADIR/homer/assets:/www/assets
    ports:
      - 8084:8080
    user: $PUID:$PGID

  # authelia:
  #   image: authelia/authelia
  #   container_name: authelia
  #   environment:
  #     - TZ: $TZ
  #   ports:
  #     - 9091:9091
  #   volumes:
  #     - $DATADIR/authelia/config:/config
  #   restart: unless-stopped

  unifi:
    image: linuxserver/unifi-controller
    container_name: unifi
    environment:
      - PUID=$PUID
      - PGID=$PGID
      - TZ=$TZ
      - MEM_LIMIT=1024
      - MEM_STARTUP=1024
    volumes:
      - $DATADIR/unifi/config:/config
    ports:
      - 8443:8443
      - 3478:3478/udp
      - 10001:10001/udp
      - 8080:8080
      - 8843:8843 #optional
      - 8880:8880 #optional
      - 6789:6789 #optional
      - 5514:5514/udp #optional
    restart: unless-stopped

  qbittorrent:
    image: linuxserver/qbittorrent:4.4.5
    container_name: qbittorrent
    environment:
      - PUID=$PUID
      - PGID=$PGID
      - TZ=$TZ
      - WEBUI_PORT=8090
    volumes:
      - ./qbittorrent/dracula:/dracula
      - $MEDIADIR:/media
      - $DLDIR:/downloads
      - $DATADIR/qbittorrent/autodl:/autodl
      - $DATADIR/qbittorrent/config:/config
    ports:
      - 8090:8090
      - 65432:65432
      - 65432:65432/udp
    restart: unless-stopped

  jellyfin:
    image: jellyfin/jellyfin
    container_name: jellyfin
    environment:
      - PUID=$PUID
      - PGID=$PGID
      - VERSION=docker
    group_add:
      - "989"
    network_mode: host
    volumes:
      - $MEDIADIR:/media
      - $DATADIR/jellyfin/cache:/cache
      - $DATADIR/jellyfin/config:/config
    devices:
      - /dev/dri:/dev/dri
    depends_on:
      - gotify
    restart: unless-stopped

  iron-cake:
    image: josefilipeferreira/iron-cake:master
    container_name: iron-cake
    ports:
      - "8000:8000"
    volumes:
      - $MEDIADIR/anime:/anime
      - $MEDIADIR/movies:/movies
      - $MEDIADIR/music:/music
      - $MEDIADIR/series:/series
      - ~/.local/share/wallpapers:/walls
      - ~/share:/share
      - $DATADIR/iron-cake/thumb:/thumb
    restart: unless-stopped

  jbb:
    image: josefilipeferreira/jbb.py:master
    container_name: jbb
    volumes:
      - $DATADIR/jbb/config.yaml:/config.yaml
      - $DATADIR/jbb/db:/db
      - $DATADIR/jbb/media:/media
      - $DATADIR/jbb/music:/music
    restart: unless-stopped

  merossd:
    image: josefilipeferreira/merossd:master
    container_name: merossd
    ports:
      - "4200:4200"
    volumes:
      - $DATADIR/merossd/config.yaml:/config.yaml
    restart: unless-stopped

  radicale:
    image: josefilipeferreira/docker-radicale:master
    container_name: radicale
    ports:
      - "5232:5232"
    volumes:
      - ~/.gitconfig:/etc/gitconfig
      - $DATADIR/radicale/users:/users
      - $DATADIR/radicale/collections:/collections
      - $DATADIR/radicale/config:/config
    restart: unless-stopped

  rss-bridge:
    image: rssbridge/rss-bridge:latest
    container_name: rss-bridge
    ports:
      - "3000:80"
    restart: unless-stopped

  flaresolverr:
    image: flaresolverr/flaresolverr
    container_name: flaresolverr
    environment:
      - TZ=$TZ
    ports:
      - 8191:8191
    restart: unless-stopped

  prowlarr:
    image: linuxserver/prowlarr:develop
    container_name: prowlarr
    environment:
      - PUID=$PUID
      - PGID=$PGID
      - TZ=$TZ
    volumes:
      - $DATADIR/prowlarr/config:/config
    ports:
      - 9696:9696
    depends_on:
      - flaresolverr
    restart: unless-stopped

  sonarr:
    image: linuxserver/sonarr
    container_name: sonarr
    environment:
      - PUID=$PUID
      - PGID=$PGID
      - TZ=$TZ
      - UMASK_SET=022 #optional
    volumes:
      - $MEDIADIR:/media
      - $DLDIR:/downloads
      - $DATADIR/sonarr/config:/config
    ports:
      - 8989:8989
    depends_on:
      - prowlarr
      - qbittorrent
    restart: unless-stopped

  radarr:
    image: linuxserver/radarr
    container_name: radarr
    environment:
      - PUID=$PUID
      - PGID=$PGID
      - TZ=$TZ
    volumes:
      - $MEDIADIR/movies:/movies
      - $DLDIR:/downloads
      - $DATADIR/radarr/config:/config
    ports:
      - 7878:7878
    depends_on:
      - prowlarr
      - qbittorrent
    restart: unless-stopped

  calibre-web:
    image: linuxserver/calibre-web:latest
    container_name: calibre-web
    environment:
      - PUID=$PUID
      - PGID=$PGID
      - TZ=$TZ
      - DOCKER_MODS=linuxserver/mods:universal-calibre #optional
      - OAUTHLIB_RELAX_TOKEN_SCOPE=1 #optional
    volumes:
      - $DATADIR/calibre-web/config:/config
      - $DATADIR/calibre/config/Calibre Library:/books
    ports:
      - 8083:8083
    depends_on:
      - calibre
    restart: unless-stopped

  calibre:
    image: linuxserver/calibre:latest
    container_name: calibre
    environment:
      - PUID=$PUID
      - PGID=$PGID
      - TZ=$TZ
    volumes:
      - $DATADIR/calibre/config:/config
      - $DATADIR/calibre/import:/import
    ports:
      - 8082:8080
      - 8081:8081
    restart: unless-stopped

  bazarr:
    image: linuxserver/bazarr
    container_name: bazarr
    environment:
      - PUID=$PUID
      - PGID=$PGID
      - TZ=$TZ
    volumes:
      - $MEDIADIR:/media
      - $DATADIR/bazarr/config:/config
    ports:
      - 6767:6767
    restart: unless-stopped

  photoprism:
    image: photoprism/photoprism:latest
    container_name: photoprism
    depends_on:
      - mariadb
    restart: unless-stopped
    security_opt:
      - seccomp:unconfined
      - apparmor:unconfined
    ports:
      - 2342:2342
    environment:
      PHOTOPRISM_ADMIN_PASSWORD: "insecure"          # INITIAL PASSWORD FOR "admin" USER, MINIMUM 8 CHARACTERS
      PHOTOPRISM_AUTH_MODE: "password"               # authentication mode (public, password)
      PHOTOPRISM_SITE_URL: "http://localhost:2342/"  # public server URL incl http:// or https:// and /path, :port is optional
      PHOTOPRISM_ORIGINALS_LIMIT: 5000               # file size limit for originals in MB (increase for high-res video)
      PHOTOPRISM_HTTP_COMPRESSION: "gzip"            # improves transfer speed and bandwidth utilization (none or gzip)
      PHOTOPRISM_LOG_LEVEL: "info"                   # log level: trace, debug, info, warning, error, fatal, or panic
      PHOTOPRISM_READONLY: "false"                   # do not modify originals directory (reduced functionality)
      PHOTOPRISM_EXPERIMENTAL: "false"               # enables experimental features
      PHOTOPRISM_DISABLE_CHOWN: "false"              # disables updating storage permissions via chmod and chown on startup
      PHOTOPRISM_DISABLE_WEBDAV: "true"              # disables built-in WebDAV server
      PHOTOPRISM_DISABLE_SETTINGS: "false"           # disables settings UI and API
      PHOTOPRISM_RAW_PRESETS: "false"                # enables applying user presets when converting RAW files (reduces performance)
      PHOTOPRISM_JPEG_QUALITY: 85                    # quality and file size of JPEG images and thumbnails (25-100)
      PHOTOPRISM_DATABASE_DRIVER: "mysql"            # use MariaDB 10.5+ or MySQL 8+ instead of SQLite for improved performance
      PHOTOPRISM_DATABASE_SERVER: "mariadb:3306"     # MariaDB or MySQL database server (hostname:port)
      PHOTOPRISM_DATABASE_NAME: "photoprism"         # MariaDB or MySQL database schema name
      PHOTOPRISM_DATABASE_USER: "photoprism"         # MariaDB or MySQL database user name
      PHOTOPRISM_DATABASE_PASSWORD: "insecure"       # MariaDB or MySQL database user password
      PHOTOPRISM_SITE_CAPTION: "Life Adventures"
      PHOTOPRISM_SITE_DESCRIPTION: "All My Adventures in one place"
      PHOTOPRISM_SITE_AUTHOR: "jff"
      ## Run/install on first startup (options: update gpu tensorflow davfs clitools clean):
      # PHOTOPRISM_INIT: "gpu tensorflow"
      ## Hardware Video Transcoding (for sponsors only due to high maintenance and support costs):
      # PHOTOPRISM_FFMPEG_ENCODER: "software"        # FFmpeg encoder ("software", "intel", "nvidia", "apple", "raspberry")
      # PHOTOPRISM_FFMPEG_BITRATE: "32"              # FFmpeg encoding bitrate limit in Mbit/s (default: 50)
      ## Run as a non-root user after initialization (supported: 0, 33, 50-99, 500-600, and 900-1200):
      # PHOTOPRISM_UID: $PUID
      # PHOTOPRISM_GID: $PGID
      # PHOTOPRISM_UMASK: 0000
    ## Start as non-root user before initialization (supported: 0, 33, 50-99, 500-600, and 900-1200):
    # user: ${PUID}:${PGID}
    devices:
     - "/dev/dri:/dev/dri"
    working_dir: "/photoprism"
    volumes:
      - "~/phone:/photoprism/originals"               # Original media files (DO NOT REMOVE)
      # - "/example/family:/photoprism/originals/family" # *Additional* media folders can be mounted like this
      # - "~/Import:/photoprism/import"                  # *Optional* base folder from which files can be imported to originals
      - $DATADIR/photoprism/storage:/photoprism/storage

  mariadb:
    restart: unless-stopped
    image: mariadb:10.8
    container_name: mariadb
    security_opt:
      - seccomp:unconfined
      - apparmor:unconfined
    command: mysqld --innodb-buffer-pool-size=512M --transaction-isolation=READ-COMMITTED --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci --max-connections=512 --innodb-rollback-on-timeout=OFF --innodb-lock-wait-timeout=120
    volumes:
      - $DATADIR/mariadb:/var/lib/mysql
    environment:
      MARIADB_AUTO_UPGRADE: "1"
      MARIADB_INITDB_SKIP_TZINFO: "1"
      MARIADB_DATABASE: "photoprism"
      MARIADB_USER: "photoprism"
      MARIADB_PASSWORD: "insecure"
      MARIADB_ROOT_PASSWORD: "insecure"

  gotify:
    image: gotify/server
    container_name: gotify
    ports:
      - 2323:80
    environment:
      - GOTIFY_DEFAULTUSER_PASS=insecure
    volumes:
      - $DATADIR/gotify/data:/app/data

  watchtower:
    image: containrrr/watchtower
    container_name: watchtower
    environment:
      - WATCHTOWER_POLL_INTERVAL = 21600
      - WATCHTOWER_INCLUDE_STOPPED = true
      - WATCHTOWER_REVIVE_STOPPED = true
      - WATCHTOWER_CLEANUP = true
      - WATCHTOWER_NO_STARTUP_MESSAGE = true
      - WATCHTOWER_NOTIFICATIONS=gotify
      - WATCHTOWER_NOTIFICATION_GOTIFY_URL=http://192.168.1.80:2323/
      - WATCHTOWER_NOTIFICATION_GOTIFY_TOKEN=/gotify_token
      - TZ=$TZ
    depends_on:
      - gotify
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ~/.config/docker/config.json:/config.json
      - $DATADIR/watchtower/gotify_token:/gotify_token
