version: "3.9"

# qbittorrent 8090 6881
# iron-cake   8000
# merossd     4200
# radicale    5232
# rss-bridge  3000
# prowlarr    9696
# sonarr      8989
# radarr      7878
# readarr     8787
# bazarr      6767
# photoprism  2342
# gotify      2323

services:
  qbittorrent:
    image: linuxserver/qbittorrent
    container_name: qbittorrent
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/London
      - WEBUI_PORT=8090
    volumes:
      - ./qbittorrent/dracula:/dracula
      - /mnt/media:/media
      - ~/dl:/downloads
      - ~/suitcase-storage/qbittorrent/autodl:/autodl
      - ~/suitcase-storage/qbittorrent/config:/config
    ports:
      - 8090:8090
      - 6881:6881
      - 6881:6881/udp
    restart: unless-stopped

  jellyfin:
    image: jellyfin/jellyfin
    container_name: jellyfin
    environment:
      - PUID=1000
      - PGID=1000
      - VERSION=docker
    group_add:
      - "989"
    network_mode: host
    volumes:
      - /mnt/media:/media
      - /mnt/lacie/Media:/remote_media
      - ~/suitcase-storage/jellyfin/cache:/cache
      - ~/suitcase-storage/jellyfin/config:/config
    devices:
      - /dev/dri:/dev/dri
    depends_on:
      - gotify
    restart: unless-stopped

  iron-cake:
    image: josefilipeferreira/iron-cake:master
    container_name: iron-cake
    ports:
      - "8000:8000"
    volumes:
      - /mnt/media/anime:/anime
      - /mnt/media/movies:/movies
      - /mnt/media/music:/music
      - /mnt/media/series:/series
      - ~/.local/share/wallpapers:/walls
      - ~/share:/share
      - ~/suitcase-storage/iron-cake/thumb:/thumb
    restart: unless-stopped

  jbb:
    image: josefilipeferreira/jbb.py:master
    container_name: jbb
    volumes:
      - ~/suitcase-storage/jbb/config.yaml:/config.yaml
      - ~/suitcase-storage/jbb/db:/db
      - ~/suitcase-storage/jbb/media:/media
      - ~/suitcase-storage/jbb/music:/music
    restart: unless-stopped

  merossd:
    image: josefilipeferreira/merossd:master
    container_name: merossd
    ports:
      - "4200:4200"
    volumes:
      - ~/suitcase-storage/merossd/config.yaml:/config.yaml
    restart: unless-stopped

  radicale:
    container_name: radicale
    build: ./radicale
    ports:
      - "5232:5232"
    volumes:
      - ~/.gitconfig:/etc/gitconfig
      - ~/suitcase-storage/radicale:/radicale
    restart: unless-stopped

  rss-bridge:
    image: rssbridge/rss-bridge:latest
    container_name: rss-bridge
    ports:
      - "3000:80"
    restart: unless-stopped

  flaresolverr:
    image: flaresolverr/flaresolverr
    container_name: flaresolverr
    environment:
      - TZ=Europe/London
    ports:
      - 8191:8191
    restart: unless-stopped

  prowlarr:
    image: linuxserver/prowlarr:develop
    container_name: prowlarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/London
    volumes:
      - ~/suitcase-storage/prowlarr/config:/config
    ports:
      - 9696:9696
    depends_on:
      - flaresolverr
    restart: unless-stopped

  sonarr:
    image: linuxserver/sonarr
    container_name: sonarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/London
      - UMASK_SET=022 #optional
    volumes:
      - /mnt/media:/media
      - ~/dl:/downloads
      - ~/suitcase-storage/sonarr/config:/config
    ports:
      - 8989:8989
    depends_on:
      - prowlarr
      - qbittorrent
    restart: unless-stopped

  radarr:
    image: linuxserver/radarr
    container_name: radarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/London
    volumes:
      - /mnt/media/movies:/movies
      - ~/dl:/downloads
      - ~/suitcase-storage/radarr/config:/config
    ports:
      - 7878:7878
    depends_on:
      - prowlarr
      - qbittorrent
    restart: unless-stopped

  bazarr:
    image: linuxserver/bazarr
    container_name: bazarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/London
    volumes:
      - /mnt/media:/media
      - ~/suitcase-storage/bazarr/config:/config
    ports:
      - 6767:6767
    restart: unless-stopped

  readarr:
    image: linuxserver/readarr:develop
    container_name: readarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/London
    volumes:
      - /mnt/media/books:/books
      - ~/dl:/downloads
      - ~/suitcase-storage/readarr/config:/config
    ports:
      - 8787:8787
    depends_on:
      - prowlarr
      - qbittorrent
    restart: unless-stopped


  photoprism:
    image: photoprism/photoprism:latest
    container_name: photoprism
    depends_on:
      - mariadb
    restart: unless-stopped
    security_opt:
      - seccomp:unconfined
      - apparmor:unconfined
    ports:
      - 2342:2342
    environment:
      PHOTOPRISM_ADMIN_PASSWORD: "insecure"          # INITIAL PASSWORD FOR "admin" USER, MINIMUM 8 CHARACTERS
      PHOTOPRISM_AUTH_MODE: "password"               # authentication mode (public, password)
      PHOTOPRISM_SITE_URL: "http://localhost:2342/"  # public server URL incl http:// or https:// and /path, :port is optional
      PHOTOPRISM_ORIGINALS_LIMIT: 5000               # file size limit for originals in MB (increase for high-res video)
      PHOTOPRISM_HTTP_COMPRESSION: "gzip"            # improves transfer speed and bandwidth utilization (none or gzip)
      PHOTOPRISM_LOG_LEVEL: "info"                   # log level: trace, debug, info, warning, error, fatal, or panic
      PHOTOPRISM_READONLY: "false"                   # do not modify originals directory (reduced functionality)
      PHOTOPRISM_EXPERIMENTAL: "false"               # enables experimental features
      PHOTOPRISM_DISABLE_CHOWN: "false"              # disables updating storage permissions via chmod and chown on startup
      PHOTOPRISM_DISABLE_WEBDAV: "true"              # disables built-in WebDAV server
      PHOTOPRISM_DISABLE_SETTINGS: "false"           # disables settings UI and API
      PHOTOPRISM_RAW_PRESETS: "false"                # enables applying user presets when converting RAW files (reduces performance)
      PHOTOPRISM_JPEG_QUALITY: 85                    # quality and file size of JPEG images and thumbnails (25-100)
      PHOTOPRISM_DATABASE_DRIVER: "mysql"            # use MariaDB 10.5+ or MySQL 8+ instead of SQLite for improved performance
      PHOTOPRISM_DATABASE_SERVER: "mariadb:3306"     # MariaDB or MySQL database server (hostname:port)
      PHOTOPRISM_DATABASE_NAME: "photoprism"         # MariaDB or MySQL database schema name
      PHOTOPRISM_DATABASE_USER: "photoprism"         # MariaDB or MySQL database user name
      PHOTOPRISM_DATABASE_PASSWORD: "insecure"       # MariaDB or MySQL database user password
      PHOTOPRISM_SITE_CAPTION: "Life Adventures"
      PHOTOPRISM_SITE_DESCRIPTION: "All My Adventures in one place"
      PHOTOPRISM_SITE_AUTHOR: "jff"
      ## Run/install on first startup (options: update gpu tensorflow davfs clitools clean):
      # PHOTOPRISM_INIT: "gpu tensorflow"
      ## Hardware Video Transcoding (for sponsors only due to high maintenance and support costs):
      # PHOTOPRISM_FFMPEG_ENCODER: "software"        # FFmpeg encoder ("software", "intel", "nvidia", "apple", "raspberry")
      # PHOTOPRISM_FFMPEG_BITRATE: "32"              # FFmpeg encoding bitrate limit in Mbit/s (default: 50)
      ## Run as a non-root user after initialization (supported: 0, 33, 50-99, 500-600, and 900-1200):
      # PHOTOPRISM_UID: 1000
      # PHOTOPRISM_GID: 1000
      # PHOTOPRISM_UMASK: 0000
    ## Start as non-root user before initialization (supported: 0, 33, 50-99, 500-600, and 900-1200):
    # user: "1000:1000"
    devices:
     - "/dev/dri:/dev/dri"
    working_dir: "/photoprism"
    volumes:
      - "~/phone:/photoprism/originals"               # Original media files (DO NOT REMOVE)
      # - "/example/family:/photoprism/originals/family" # *Additional* media folders can be mounted like this
      # - "~/Import:/photoprism/import"                  # *Optional* base folder from which files can be imported to originals
      - "~/suitcase-storage/photoprism/storage:/photoprism/storage"

  mariadb:
    restart: unless-stopped
    image: mariadb:10.8
    container_name: mariadb
    security_opt:
      - seccomp:unconfined
      - apparmor:unconfined
    command: mysqld --innodb-buffer-pool-size=512M --transaction-isolation=READ-COMMITTED --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci --max-connections=512 --innodb-rollback-on-timeout=OFF --innodb-lock-wait-timeout=120
    volumes:
      - ~/suitcase-storage/mariadb:/var/lib/mysql
    environment:
      MARIADB_AUTO_UPGRADE: "1"
      MARIADB_INITDB_SKIP_TZINFO: "1"
      MARIADB_DATABASE: "photoprism"
      MARIADB_USER: "photoprism"
      MARIADB_PASSWORD: "insecure"
      MARIADB_ROOT_PASSWORD: "insecure"

  gotify:
    image: gotify/server
    container_name: gotify
    ports:
      - 2323:80
    environment:
      - GOTIFY_DEFAULTUSER_PASS=insecure
    volumes:
      - ~/suitcase-storage/gotify/data:/app/data

  watchtower:
    image: containrrr/watchtower
    container_name: watchtower
    environment:
      - WATCHTOWER_POLL_INTERVAL = 21600
      - WATCHTOWER_INCLUDE_STOPPED = true
      - WATCHTOWER_REVIVE_STOPPED = true
      - WATCHTOWER_CLEANUP = true
      - WATCHTOWER_NO_STARTUP_MESSAGE = true
      - WATCHTOWER_NOTIFICATIONS=gotify
      - WATCHTOWER_NOTIFICATION_GOTIFY_URL=https://jff.sh/gotify/
      - WATCHTOWER_NOTIFICATION_GOTIFY_TOKEN=/gotify_token
      - TZ=Europe/Lisbon
    depends_on:
      - gotify
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ~/.config/docker/config.json:/config.json
      - ~/suitcase-storage/watchtower/gotify_token:/gotify_token
